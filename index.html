<html style="zoom: 150%;">

<style>

	div.country {
		background: #DDDDDD;
		border-radius: 0.3em;
		display: inline-block;
  		padding: 0.3em;
    	margin: 5px;
	}
</style>

<head>
	<title>Corona Stats</title>
</head>

<body>

	<div class="autocomplete" style="width:300px;">
		<input id="filterInput" onChange="addFilter()" list="filterOptions" />
		<datalist id="filterOptions"></datalist>
  		<button class="add" onclick="addFilter()">Add</button>
	</div>

	<div id="countryFilter" style="margin-top: 10px;">	</div>

	<div style="margin-top: 10px;">
		<table class="sortable" id="table_summary" width="100%">
			<thead style="text-align: left">
				<tr>
					<th>Country</th>
					<th>Total Cases</th>
					<th>New Cases</th>
					<th>Total Deaths</th>
					<th>New Deaths</th>
				</tr>
			</thead>
			<tbody id="summary_content">
			</tbody>
		</table>
	</div>

</body>

<script>
	var filter_countries = ["United States of America", "Germany", "France", "Korea (South)"];
	var countries = [];

	updateFilter();
	loadCountries();

	function addFilter(){
		var input = document.getElementById('filterInput').value;

		if(!countries.includes(input)) return;
		if(filter_countries.includes(input)) return;

		filter_countries.push(input); 
		document.getElementById('filterInput').value = '';
		updateFilter();
	}

	function updateFilter(){
		document.getElementById('countryFilter').innerHTML = '';

		filter_countries.forEach(function(item, index){
			var div = document.createElement("div");

			div.id = item;
			div.className = 'country';
			div.innerHTML = item;
			div.addEventListener("click", function(){
				filter_countries.splice(index, 1);
				updateFilter();
			});

			document.getElementById('countryFilter').appendChild(div);
		})

		loadSummary();
	}

	function loadSummary() {
		var request = new XMLHttpRequest();
		request.open('GET', 'https://api.covid19api.com/summary', true);

		request.onload = function () {
			var data = JSON.parse(this.response);
			var countries = data.Countries;
			
			var table = document.getElementById("summary_content");
			table.innerHTML = '';

			for(var i = 0; i < countries.length; i++) {
			    var obj = countries[i];

				if(!filter_countries.includes(obj["Country"])) continue;

				var row = table.insertRow(-1);

				var country = row.insertCell(0);
				country.innerHTML = obj["Country"];
				var totalCases = row.insertCell(1);
				totalCases.innerHTML = obj["TotalConfirmed"];
				var newCases = row.insertCell(2);
				newCases.innerHTML = obj["NewConfirmed"];
				var totalDeaths = row.insertCell(3);
				totalDeaths.innerHTML = obj["TotalDeaths"];
				var newDeaths = row.insertCell(4);
				newDeaths.innerHTML = obj["NewDeaths"];

			}

		}

		request.send();
		sortTable(document.getElementById("summary_content"), 1);
	}

	function sortTable(table, column) {
		var x, y, shouldSwitch;
		var switching = true;
		while (switching) {
			switching = false;
			var rows = table.rows;
			for (var i = 1; i < (rows.length - 1); i++) {
			  shouldSwitch = false;
			  x = rows[i].getElementsByTagName("TD")[column];
			  y = rows[i + 1].getElementsByTagName("TD")[column];

			  if (parseInt(x.innerHTML) < parseInt(y.innerHTML)) {
			    shouldSwitch = true;
			    break;
			  }
			}
			if (shouldSwitch) {
			  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
			  switching = true;
			}
		}
	}

	function loadCountries() {
		var request = new XMLHttpRequest();
		request.open('GET', 'https://api.covid19api.com/summary', true);

		request.onload = function () {
			var data = JSON.parse(this.response);
			var dataCountries = data.Countries;
			for(var i = 0; i < dataCountries.length; i++) {
			    var obj = dataCountries[i];
			    countries.push(obj["Country"]);
			}

			var list = document.getElementById('filterOptions');
			countries.forEach(function(item){
			   var option = document.createElement('option');
			   option.value = item;
			   list.appendChild(option);
			});
		}

		request.send();
	}

</script>

</html>
