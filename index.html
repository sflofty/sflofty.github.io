<html>

<style>
	div.country {
		background: #DDDDDD;
		border-radius: 0.3em;
		display: inline-block;
  		padding: 0.3em;
  		shape-margin: 2px;
	}
</style>

<head>
	<title>Corona Stats</title>
</head>

<body>
	<div id="countryFilter">
	</div>

	<div>
		<table class="sortable" id="table_summary" width="100%">
			<thead style="text-align: left">
				<tr>
					<th>Country</th>
					<th>Total Cases</th>
					<th>New Cases</th>
					<th>Total Deaths</th>
					<th>New Deaths</th>
				</tr>
			</thead>
			<tbody id="summary_content">
			</tbody>
		</table>
	</div>

</body>

<script>
	var filter_countries = ["Germany", "France"];

	loadSummary();
	countryFilter();


	function countryFilter(){
		filter_countries.forEach(addFilter);

		function addFilter(item, index) {

			var div = document.createElement("div");

			div.id = item;
			div.className = 'country';
			div.innerHTML = item;
			document.getElementById('countryFilter').appendChild(div);
		}
	}

	function loadSummary() {

		var request = new XMLHttpRequest();

		request.open('GET', 'https://api.covid19api.com/summary', true)

		request.onload = function () {
			var data = JSON.parse(this.response);
			var countries = data.Countries;

			console.log(countries);
			
			var table = document.getElementById("summary_content");

			for(var i = 0; i < countries.length; i++) {
			    var obj = countries[i];

				if(!filter_countries.includes(obj["Country"])) continue;

				var row = table.insertRow(-1);

				var country = row.insertCell(0);
				country.innerHTML = obj["Country"];
				var totalCases = row.insertCell(1);
				totalCases.innerHTML = obj["TotalConfirmed"];
				var newCases = row.insertCell(2);
				newCases.innerHTML = obj["NewConfirmed"];
				var totalDeaths = row.insertCell(3);
				totalDeaths.innerHTML = obj["TotalDeaths"];
				var newDeaths = row.insertCell(4);
				newDeaths.innerHTML = obj["NewDeaths"];

			}

			sortTable(document.getElementById("summary_content"), 1);
		}



		request.send();
	}


	function sortTable(table, column) {
		var x, y, shouldSwitch;
		var switching = true;
		while (switching) {
			switching = false;
			var rows = table.rows;
			for (var i = 1; i < (rows.length - 1); i++) {
			  shouldSwitch = false;
			  x = rows[i].getElementsByTagName("TD")[column];
			  y = rows[i + 1].getElementsByTagName("TD")[column];

			  if (parseInt(x.innerHTML) < parseInt(y.innerHTML)) {
			    shouldSwitch = true;
			    break;
			  }
			}
			if (shouldSwitch) {
			  rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
			  switching = true;
			}
		}
	}
</script>

</html>
